# 코딩스타일 가이드 v1.0
( Vue 3 + Vite + Spring Boot 3 / Spring MVC + JDK 21 + Token 인증(재발행) )

## 0. 목적과 범위
- 프론트엔드(Vue)와 백엔드(Spring MVC) 전 영역에서 **일관된 코드 품질/가독성/유지보수성**을 확보한다.
- 프로젝트 패키지 루트는 `kr.co.iosys` 이며, 업무 도메인은 아래 구조를 따른다.
  - `kr.co.iosys.common.class` (분류 트리)
  - `kr.co.iosys.common.code` (공통 코드)
  - `kr.co.iosys.content.quiz` (문항관리)
  - `kr.co.iosys.content.test` (시험지관리)
  - `kr.co.iosys.makeq` / `kr.co.iosys.invq` / `kr.co.iosys.quizsel`
  - `kr.co.iosys.system` / `kr.co.iosys.auth`

---

## 1. 공통 규칙

### 1.1 기본 원칙
- 가독성 > 축약(짧게 쓰기)
- “규칙은 자동화”: 포맷터/린터 설정으로 강제
- 임시 코드(`console.log`, `System.out.println`, `TODO` 방치)는 커밋 금지

### 1.2 파일 규칙
- 인코딩: UTF-8
- 개행: LF
- 파일 마지막 줄 개행 유지
- trailing whitespace 제거

### 1.3 들여쓰기/라인 길이
- Front(HTML/Vue/JS/TS/CSS): **Tab 들여쓰기** (Tab size 4 권장)
- Back(Java): **4 spaces 권장** (팀이 Tab을 강제할 경우 `.editorconfig`로 일괄 적용)
- 라인 길이: 120 권장

### 1.4 중괄호(블록) 규칙
- JS/TS: `if/for/while/try/catch` 등 **모든 블록은 반드시 `{}`**
- 한 줄 if/for 금지(항상 여러 줄 블록으로 작성)

---

## 2. 네이밍 규칙(중요)

### 2.1 기본 네이밍
- 클래스/컴포넌트: PascalCase  
  - 예) `QuizListView`, `TokenService`
- 변수/함수/필드: camelCase  
  - 예) `accessToken`, `refreshToken`, `fetchQuizList`
- 상수: UPPER_SNAKE_CASE  
  - 예) `TOKEN_HEADER`, `MAX_RETRY_COUNT`

### 2.2 “테이블 컬럼 기반” camelCase 변환 규칙(필수)
변수/필드명은 **테이블 컬럼명을 기본으로** 하며, `_`(언더바) 기준으로 **camelCase로 변환**한다.

- 변환 규칙
  - 1) 전체를 소문자화(또는 단어 단위로 정규화)
  - 2) `_`로 분리한 뒤, 첫 토큰은 소문자 유지
  - 3) 이후 토큰은 첫 글자만 대문자(나머지 소문자)

- 예시
  - `USER_ID` / `user_id` → `userId`
  - `QUIZ_HISTORY_SEQ` / `quiz_history_seq` → `quizHistorySeq`
  - `MAKEQPLAN_SEQ` → `makeqplanSeq`(권장 개선: 의미 분리 가능하면 `makeqPlanSeq`)
  - `CDATETIME` → `cdatetime`(권장 개선: 컬럼이 일관되게 `c_datetime` 형태면 `cDatetime`)

> 컬럼이 언더바 없이 이미 결합된 형태(`USERPERMCD`)라면, **업무 표준 접미어**(Cd, Nm 등)를 우선 적용하여 의미를 분명히 한다.
- 예) `USERPERMCD` → `userPermCd`

### 2.3 코드 필드 규칙: `...Cd` + `...Nm`(필수)
- 코드값 필드명: `...Cd`
- 코드명(표시명) 필드명: `...Nm` (DB에서는 보통 `..._NM` 형태)

예시
- `userPermCd`, `userPermNm`
- `deviceCd`, `deviceNm`
- `quizStatCd`, `quizStatNm`

> “코드명에는 _Nm을 부여” 규칙에 따라, 코드값과 짝을 이루는 이름 필드는 반드시 `Nm`으로 끝나도록 한다.

### 2.4 약어/접미어 표준(권장)
- 날짜/시간: `...At`, `...Dt`, `...Datetime` 중 하나로 통일(테이블 표준에 맞춤)
- 여부: `...Yn`(Y/N), Boolean은 `is...`(JS) 또는 `...Yn`(DB 연동 우선)
- 수량: `...Cnt`
- 번호: `...No`
- 순번/정렬: `...Seq`, `...OrderNo`, `...SortKey`
- 경로/파일: `...Path`, `...FilePath`, `...OrgnFileNm`

---

## 3. 프론트엔드(Vue + Vite)

### 3.1 디렉터리 권장 구조
- `src/pages/` : 라우팅 단위 화면
- `src/components/` : 공용 컴포넌트
- `src/features/` : 도메인 단위 기능 묶음(예: content/quiz, content/test)
- `src/api/` : API 모듈(도메인별 파일 분리)
- `src/stores/` : Pinia store
- `src/utils/` : 공통 유틸

### 3.2 Vue 작성 규칙
- `script setup` 권장(Composition API)
- 화면(페이지)에서 API 직접 호출 남발 금지  
  - API 호출은 `api/*` 또는 `stores/*`로 위임
- 로딩/에러 상태는 명확히 분리하여 관리
- 컴포넌트 책임 과다 금지(목록/상세/편집은 분리)

### 3.3 Template 포맷 규칙
- 태그는 가능한 한 한 줄 유지, 속성이 길면 줄바꿈
- 들여쓰기는 Tab
- 속성 정렬 권장
  1) `v-if / v-show / v-for`
  2) `:key`
  3) `class`, `style`
  4) `:prop` 바인딩
  5) 이벤트 `@click` 등
  6) 기타 속성

### 3.4 API/에러 처리(프론트)
- Axios 인터셉터에서 공통 처리
- 401(Access 만료) → `/api/auth/refresh` 호출 → 성공 시 원 요청 재시도
- refresh 실패(만료/폐기) → 로그인 화면 이동 및 토큰/상태 정리

---

## 4. 백엔드(Spring MVC) 구조/스타일

### 4.1 계층 책임(강제)
- Controller: 요청 검증/DTO 변환/응답 조립만(비즈니스 로직 금지)
- Service: 비즈니스 로직 + 트랜잭션 경계
- Mapper(MyBatis): SQL 및 Result 매핑
- DTO: 외부 계약(요청/응답)
- Domain(VO): 내부 처리/DB 매핑 중심

### 4.2 패키지 구조 표준(업무 단위)
각 도메인은 동일한 내부 구조를 유지한다.
- `controller / service / mapper / dto / domain`

예시
- `kr.co.iosys.content.quiz.*`
- `kr.co.iosys.content.test.*`
- `kr.co.iosys.common.class.*`
- `kr.co.iosys.common.code.*`

### 4.3 API URL Prefix 표준
- 공통
  - `/api/common/class/*`
  - `/api/common/code/*`
- 콘텐츠(통합)
  - `/api/content/quiz/*`
  - `/api/content/test/*`
- 업무
  - `/api/makeq/*`
  - `/api/invq/*`
  - `/api/quizsel/*`
- 시스템/인증
  - `/api/system/*`
  - `/api/auth/*`

### 4.4 공통 응답 래퍼(필수)
모든 API 응답은 아래 래퍼를 유지한다.
- `result`: `success | fail`
- `message`: 사용자 안내 메시지
- `errorMessage`: 내부/시스템 메시지(정책에 따라 노출 제한)
- `data`: 실제 데이터

---

## 5. 인증/인가(Token + 재발행 필수)

### 5.1 토큰 정책(권장)
- Access Token: 짧은 만료(예: 15~30분)
- Refresh Token: 긴 만료(예: 7~30일), **재발행(Refresh) 필수**
- Stateless(Spring Security)

### 5.2 필수 엔드포인트
- `POST /api/auth/login` : access + refresh 발급
- `POST /api/auth/refresh` : access 재발급(필수), 정책에 따라 refresh 회전
- `POST /api/auth/logout` : refresh 폐기(서버 저장소 무효화 권장)

### 5.3 구현 규칙
- `Authorization: Bearer <accessToken>` 고정
- refreshToken은 서버 저장형(DB/Redis, 해시 저장 권장)
- refresh 회전(rotation) + 재사용 탐지(권장)

---

## 6. MyBatis(SQL) 스타일

### 6.1 SQL 포맷
- 키워드 대문자: `SELECT`, `FROM`, `WHERE`, `JOIN`
- 들여쓰기/정렬을 통해 조건 가독성 확보
- 컬럼은 snake_case, 필요한 경우 `AS`로 camelCase 매핑

### 6.2 동적 SQL
- 동적 조건이 많으면 Query DTO로 정리
- 정렬/컬럼명은 화이트리스트로 검증(인젝션 방지)

### 6.3 성능
- 목록 조회는 페이징 전제
- N+1 유발 패턴 금지(필요 시 JOIN/서브쿼리/배치)

---

## 7. 예외/로그/감사(필수)

### 7.1 예외 처리
- 도메인별 ErrorCode(권장) + 공통 BusinessException
- GlobalExceptionHandler에서 공통 래퍼 형태로 응답 변환
- 사용자 메시지와 시스템 메시지 분리

### 7.2 로깅 규칙
- `System.out.println` 금지, SLF4J 사용
- 민감정보(비밀번호/토큰/주민번호 등) 로그 금지
- 요청 추적 `requestId`(MDC) 권장

### 7.3 감사로그(작업로그) 기록 대상
- 등록/수정/삭제(논리삭제 포함)
- 상태 변경(확정/마감/회수/반려/제출 등)
- 다운로드/엑셀 내보내기
- 권한/계정 변경

---

## 8. Git/리뷰 규칙(권장)
- 커밋 메시지: `feat:`, `fix:`, `refactor:`, `docs:`, `chore:`, `test:` 접두어 권장
- PR에는 최소 포함
  - 변경 요약
  - 영향 범위(도메인/API)
  - 테스트 방법
  - DB 변경 여부(DDL/Migration)

---

## 9. 체크리스트(실무 적용)
- [ ] 변수/필드명은 컬럼 기반 camelCase 변환을 따르는가?
- [ ] 코드 필드는 `...Cd / ...Nm` 짝이 유지되는가?
- [ ] Controller에 비즈니스 로직이 섞여 있지 않은가?
- [ ] 응답 래퍼 형식이 전 API에서 동일한가?
- [ ] 401 처리 시 refresh 재발행 플로우가 표준화되어 있는가?
- [ ] 주요 작업이 감사로그에 남는가?
